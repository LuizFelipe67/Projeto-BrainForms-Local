<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Menu - BrainForms</title>
    
    <style>
        
        /* Estiliza o corpo da p√°gina */
body {
    font-family: 'Roboto', sans-serif; /* Fonte da p√°gina */
    background-color: #775085; /* Cor de fundo roxa */
    display: flex; /* Usando flexbox para centralizar conte√∫do */
    justify-content: center; /* Centraliza horizontalmente */
    align-items: center; /* Centraliza verticalmente */
    min-height: 100vh; /* Altura da tela inteira */
    margin: 0; /* Remove margens padr√£o */
    padding-bottom: 200px; /* Espa√ßo EXTRA abaixo da box */
    overflow-y: auto; /* Permite rolar verticalmente */
}

 /* LOGO E TEXTO NO CANTO SUPERIOR ESQUERDO DO FUNDO */
    .background-logo-container {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 0;
    }

    .background-logo-container img {
      width: 100px;
      height: auto;
    }

    .background-logo-container span {
      color: white;
      font-size: 48px;
      font-weight: bold;
      font-family: 'Roboto', sans-serif;
    }

/* Container principal do menu */
.menu-container {
    background-color: #fff; /* Fundo branco */
    border-radius: 12px; /* Cantos arredondados */
    box-shadow: 0 0 20px rgba(34, 2, 45, 0.6); /* Sombra mais vis√≠vel */
    text-align: center; /* Centraliza texto */
    top: 120px;
    width: 400px;
    height: 600px;
    display: flex; /* Flexbox para organiza√ß√£o */
    flex-direction: column; /* Itens em coluna */
    overflow: hidden; /* Esconde overflow */
    position: relative; /* Necess√°rio para posicionar o rodap√© */
}


/* Cabe√ßalho dentro do container do menu */
.header-container {
    display: flex; /* Flexbox para alinhar texto e imagem na horizontal */
    align-items: center; /* Alinha verticalmente ao centro */
    background: linear-gradient(to bottom, #000000 0%, #3A024E 80%); /* Gradiente invertido */
    padding: 15px 20px; /* Espa√ßamento interno */
    border-radius: 12px 12px 0 0; /* Cantos arredondados s√≥ no topo */
    color: white; /* Cor do texto */
    width: 100%; /* Largura total do container */
    margin-bottom: 30px; /* Espa√ßo abaixo do cabe√ßalho */
}

/* Estilo da imagem do logo no cabe√ßalho */
.header-container img {
    width: 65px; /* Largura da imagem */
    margin-right: 10px; /* Espa√ßo √† direita da imagem */
}

/* Estilo do t√≠tulo dentro do cabe√ßalho */
.header-container h3 {
    margin: 0; /* Remove margem padr√£o */
    font-size: 20px; /* Tamanho da fonte menor */
}

/* Estilo do t√≠tulo da se√ß√£o principal */
.menu-container h2 {
    text-align: left; /* Alinha o texto √† esquerda */
    padding-left: 20px; /* Espa√ßo √† esquerda */
    margin-top: 2px; /* Pequena margem superior */
    color: #5E097E; /* Cor roxa */
    margin-bottom: -30px;
}

/* Container que agrupa os bot√µes */
.button-container {
    flex-grow: 1;       /* ocupa todo espa√ßo restante */
    overflow-y: auto;   /* rolagem vertical se necess√°rio */
    display: flex; /* Flexbox */
    flex-direction: column; /* Itens em coluna */
    gap: 10px; /* Espa√ßo entre os bot√µes */
    align-items: center; /* Centraliza horizontalmente */
    margin-top: 60px; /* Espa√ßo acima */
    padding: 0 20px; /* Espa√ßamento lateral */
    overflow: visible;

}

/* Linha que cont√©m dois bot√µes lado a lado */
.button-container .row {
    display: flex; /* Flexbox */
    gap: 20px; /* Espa√ßo entre os bot√µes */
    justify-content: center; /* Centraliza os bot√µes */
    width: 100%; /* Ocupa toda largura */
}

/* Estilo dos bot√µes dentro do container do menu */
.menu-container button {
    background-color: #F2F3FD; /* Fundo claro */
    color: #5E097E; /* Texto roxo */
    border: 2px solid #440459; /* Borda mais grossa */
    border-radius: 16px; /* Cantos mais arredondados */
    padding: 10px; /* Espa√ßamento interno reduzido */
    font-size: 16px; /* Tamanho da fonte menor */
    font-weight: bold; /* Negrito */
    cursor: pointer; /* Cursor tipo m√£ozinha */
    width: 100%; /* Largura total do bot√£o */
    height: auto;
    max-height: 160px;
    min-height: 80px;        /* altura m√≠nima */
    display: flex; /* Flexbox para alinhar imagem e texto */
    flex-direction: column; /* Organiza itens em coluna */
    align-items: center; /* Centraliza horizontalmente */
    justify-content: center; /* Centraliza verticalmente */
    box-shadow: 10px 0 14px rgba(34, 2, 45, 0.5); /* Sombra para a direita */
    flex-shrink: 1;          /* permite encolher */
    overflow: hidden;
    white-space: normal;     /* permite quebra de linha */
    text-overflow: ellipsis;
}

/* Efeito visual ao passar o mouse sobre os bot√µes */
.menu-container button:hover {
    box-shadow: 12px 0 18px rgba(48, 10, 62, 0.7); /* Sombra mais intensa √† direita */
    background-color: #D8D2F0;
    transform: scale(1.02);
}

/* Estilo para a imagem dentro dos bot√µes */
.menu-container button img {
    width: 50px; /* Largura da imagem menor */
    height: 50px; /* Altura da imagem menor */
    margin-bottom: 15px; /* Espa√ßo abaixo da imagem */
    flex-shrink: 0;      /* imagem n√£o encolhe */
}

/* Estilo do texto dentro dos bot√µes (span) */
.button-container span {
    font-size: 16px; /* Fonte menor para melhor adapta√ß√£o */
    word-break: break-word; /* Quebra o texto grande */
}

/* Bot√µes com imagem e texto lado a lado */
.menu-container .questionarios-button,
.menu-container .minigames-button {
    flex-direction: row;
    align-items: center;
    height: auto;
    max-height: 160px;
}

/* Ajuste da imagem no bot√£o "Question√°rios" */
.menu-container .questionarios-button img {
    margin-right: 15px;
    margin-bottom: 0;
    width: 50px;
    height: 50px;
}

/* Ajuste da imagem no bot√£o "Mini Games" */
.menu-container .minigames-button img {
    margin-bottom: -5px;
    margin-left: 15px;
    width: 50px;
    height: 50px;
}

/* Rodap√© fixo na parte inferior do container */
.footer {
    background-color: #300A3E; /* Cor do rodap√© */
    display: flex; /* Flexbox */
    justify-content: center; /* Centraliza os √≠cones */
    align-items: center; /* Centraliza verticalmente */
    position: absolute; /* Posicionamento absoluto dentro do container */
    bottom: 0; /* Fixa na parte inferior */
    width: 100%; /* Ocupa toda a largura */
    height: 80px; /* Altura aumentada do rodap√© */
    gap: 80px; /* Espa√ßo entre os √≠cones */
    padding: 0; /* remove padding que pode deslocar o conte√∫do */
}

/* Estilo das imagens do rodap√© */
.footer img {
    width: 65px;
    height: 60px;
    padding: 0;
    display: block;
    margin: 0; 
   
}



/* Avatar circular com anel gradiente uniforme */
.footer a[href="avatar.html"] {
   
    --ring: 3px;

    display: inline-grid;
    place-items: center;
    width: 58px;   /* tamanho total com anel */
    height: 58px;
    border-radius: 50%;
    position: relative; /* needed for ::before ring */
    background:  linear-gradient(180deg, #00f7ff 0%, #6a00ff 35%, #f82dff 100%); 
    box-shadow: 0 0 8px rgba(106,0,255,0.10);
}


/* Garante que a imagem do avatar fique certinha dentro do anel */
#menuAvatar {
    /* size avatar to fit inside the punched ring */
    width: calc(100% - (var(--ring) * 2));
    height: calc(100% - (var(--ring) * 2));
    border-radius: 50%;
    object-fit: cover;
    z-index: 1; /* sit above the ::before ring */
}




.blurred {
  filter: blur(5px);
}

.start-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(135deg, rgba(94, 9, 126, 0.95) 0%, rgba(119, 80, 133, 0.95) 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.start-box {
  background: white;
  width: 90%;
  max-width: 500px;
  min-height: 450px;
  padding: 40px 30px;
  border-radius: 20px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  text-align: center;
  animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.tutorial-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 20px;
  width: 100%;
}

.tutorial-content img {
  width: 120px;
  height: 120px;
  object-fit: contain;
  margin-bottom: 10px;
}

.start-box h1 {
  font-size: 32px;
  color: #5E097E;
  margin: 0;
  font-weight: 700;
}

.start-box h3 {
  font-size: 18px;
  color: #333;
  line-height: 1.6;
  margin: 0;
  font-weight: 400;
}

.tutorial-navigation {
  display: flex;
  gap: 15px;
  width: 100%;
  margin-top: 20px;
}

.tutorial-navigation button {
  flex: 1;
  padding: 14px 20px;
  font-size: 16px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-skip {
  background-color: #e0e0e0;
  color: #333;
}

.btn-skip:hover {
  background-color: #d0d0d0;
  transform: translateY(-2px);
}

.btn-next {
  background: linear-gradient(135deg, #5E097E 0%, #9036e4 100%);
  color: white;
}

.btn-next:hover {
  background: linear-gradient(135deg, #9036e4 0%, #b368f5 100%);
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(94, 9, 126, 0.4);
}

.progress-dots {
  display: flex;
  gap: 8px;
  margin: 20px 0;
}

.progress-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: #d0d0d0;
  transition: all 0.3s ease;
}

.progress-dot.active {
  background: linear-gradient(135deg, #5E097E 0%, #9036e4 100%);
  width: 30px;
  border-radius: 5px;
}


 /* Responsivo para telas pequenas */
     @media (max-width: 480px) {
        body {
          margin: 0;
          bottom: 0;
          padding-bottom: 0;
          flex-direction: column;
        }

        .background-logo-container {
          display: none; /* Remove logo do fundo */
        }

        .start-box {
          width: 90%;
          min-height: 400px;
          padding: 30px 20px;
        }

        .start-box h1 {
          font-size: 24px;
        }

        .start-box h3 {
          font-size: 16px;
        }

        .tutorial-content img {
          width: 90px;
          height: 90px;
        }

        .tutorial-navigation button {
          padding: 12px 15px;
          font-size: 14px;
        }

        .menu-container {
        top: -1px;
        position: relative;
        margin: 0 auto;
        width: 95%;
        height: 98vh; /* altura total vis√≠vel */
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* empurra o rodap√© para o fim */
        box-sizing: border-box;
      }

      .menu-container button{
        margin-top: 50px;
      
      }

      .menu-container h2{
        margin-top: 20px;
      }

       .menu-container button img {
            width: 65px; /* Largura da imagem menor */
            height: 65px; /* Altura da imagem menor */
        }

        /* Estilo do texto dentro dos bot√µes (span) */
        .button-container span {
            font-size: 18px; /* Fonte menor para melhor adapta√ß√£o */
        }

        /* Bot√µes com imagem e texto lado a lado */
        .menu-container .questionarios-button,
        .menu-container .minigames-button {
            margin-top: 15px;
            flex-direction: row;
            align-items: center;
            height: 100px;
        }

        /* Ajuste da imagem no bot√£o "Question√°rios" */
        .menu-container .questionarios-button img {
            margin-right: 15px;
            margin-bottom: 0;
            width: 65px;
            height: 65px;
        }

        /* Ajuste da imagem no bot√£o "Mini Games" */
        .menu-container .minigames-button img {
            margin-bottom: -5px;
            margin-left: 15px;
            width: 65px;
            height: 65px;
        }
        
    }

    /* Responsivo para telas grandes */
    @media (min-width: 1440px) {
        .background-logo-container img {
        width: 150px;
        height: auto;
        }

        .background-logo-container span {
        font-size: 58px;

        }

      .start-box {
        max-width: 600px;
        min-height: 500px;
        padding: 50px 40px;
      }

      .start-box h1 {
        font-size: 36px;
      }

      .start-box h3 {
        font-size: 20px;
      }

      .tutorial-content img {
        width: 140px;
        height: 140px;
      }

      .menu-container {
        top: 5px;
        width: 500px;
        height: 700px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding-bottom: 0;
        position: relative;
        transform: translateX(-1px); /*GARANTE CENTRALIZA√á√ÉO IGUAL LOGIN*/
      }

      .boas-vindas {
        font-size: 56px;
      }

            /* Estilo da imagem do logo no cabe√ßalho */
        .header-container img {
            width: 75px; /* Largura da imagem */
            margin-right: 15px; /* Espa√ßo √† direita da imagem */
        }

        /* Estilo do t√≠tulo dentro do cabe√ßalho */
        .header-container h3 {
            font-size: 24px; /* Tamanho da fonte menor */
        }

      /* Estilo do t√≠tulo da se√ß√£o principal */
        .menu-container h2 {
            padding-left: 25px; /* Espa√ßo √† esquerda */
            margin-top: 3px; /* Pequena margem superior */
            margin-bottom: -10px;
            font-size: 28px;
        }

      .menu-container button img {
            width: 65px; /* Largura da imagem menor */
            height: 65px; /* Altura da imagem menor */
        }

        /* Estilo do texto dentro dos bot√µes (span) */
        .button-container span {
            font-size: 18px; /* Fonte menor para melhor adapta√ß√£o */
        }

        /* Bot√µes com imagem e texto lado a lado */
        .menu-container .questionarios-button,
        .menu-container .minigames-button {
            margin-top: 10px;
            flex-direction: row;
            align-items: center;
            height: 100px;
        }

        /* Ajuste da imagem no bot√£o "Question√°rios" */
        .menu-container .questionarios-button img {
            margin-right: 15px;
            margin-bottom: 0;
            width: 65px;
            height: 65px;
        }

        /* Ajuste da imagem no bot√£o "Mini Games" */
        .menu-container .minigames-button img {
            margin-bottom: -5px;
            margin-left: 15px;
            width: 65px;
            height: 65px;
        }

        /* Rodap√©: centralizar √≠cones e manter espa√ßamento consistente com outras telas */
        .footer {
            gap: 120px; /* mesmo espa√ßamento definido fora da media query */
        }

       .footer img {
        width: 70px;
        height: 65px;
        }


        /* Avatar circular com anel gradiente uniforme */
        .footer a[href="avatar.html"] {
            width: 63px;   
            height: 63px;
        }


}


    </style>
</head>
<body>

      <!-- LOGO E TEXTO NO BACKGROUND -->
  <div class="background-logo-container">
    <img src="Imagens/Logo sem Fundo.png" alt="Logo BrainForms Fundo">
    <span>BrainForms</span>
  </div>

    <!-- Container principal do menu -->
    <div class="menu-container">
        <!-- Cabe√ßalho com logo e t√≠tulo -->
        <div class="header-container">
            <img src="Imagens/Logo sem Fundo.png" alt="Logo BrainForms"> <!-- Logo -->
            <h3>BrainForms</h3> <!-- Nome do sistema -->
        </div>

        <!-- T√≠tulo da se√ß√£o abaixo do cabe√ßalho -->
        <h2>Navegue pelo sistema</h2>

        <!-- Container que agrupa os bot√µes -->
        <div class="button-container">
            <!-- Linha com dois bot√µes lado a lado -->
            <div class="row">
                <!-- Bot√£o para f√≥rmulas matem√°ticas -->
                <button onclick="location.href='calcular-matematica.html'">
                    <img src="Imagens/mat.png" alt="Matem√°tica"> <!-- √çcone da matem√°tica -->
                    <span>F√≥rmulas Matem√°ticas</span> <!-- Texto do bot√£o -->
                </button>

                <!-- Bot√£o para f√≥rmulas f√≠sicas -->
                <button onclick="location.href='calcular-fisica.html'">
                    <img src="Imagens/fisic.png" alt="F√≠sica"> <!-- √çcone da f√≠sica -->
                    <span>F√≥rmulas F√≠sicas</span> <!-- Texto do bot√£o -->
                </button>
            </div>

            <!-- Bot√£o para question√°rios, ocupa linha completa -->
            <button onclick="location.href='menu-questoes.html'" class="questionarios-button">
                <img src="Imagens/quest.png" alt="Question√°rio"> <!-- √çcone do question√°rio -->
                <span>Question√°rios</span> <!-- Texto do bot√£o -->
            </button>

            <!-- Bot√£o para mini games -->
            <button onclick="location.href='mini-games.html'" class="minigames-button">
                <span>Mini Games</span> <!-- Texto do bot√£o -->
                <img src="Imagens/game.png" alt="Mini Games"> <!-- √çcone dos mini games -->
            </button>
        </div>

        <!-- Rodap√© com tr√™s √≠cones (aumentados e centralizados corretamente) -->
        <div class="footer">
            <a href="avatar.html">
            <img id="menuAvatar" src="Imagens/perfil.png" alt="Perfil"> <!-- √çcone do perfil -->
            </a>

            <a href="conquistas.html">
             <img src="Imagens/conquistas.png" alt="Conquistas" style= "padding-left: 7px;"> <!-- √çcone das conquistas -->
            </a>
            
            <a href="menu.html">
            <img  src="Imagens/menu.png" alt="Menu"> <!-- √çcone do menu -->
            </a>
        </div>

    </div>


    <!-- Overlay de boas-vindas -->
    <div class="start-overlay" id="start-overlay" style="display: none;">
        <div class="start-box">
            <div class="tutorial-content" id="tutorial-content">
                <!-- Conte√∫do din√¢mico ser√° inserido aqui -->
            </div>
            
            <div class="progress-dots" id="progress-dots">
                <!-- Dots ser√£o inseridos dinamicamente -->
            </div>
            
            <div class="tutorial-navigation">
                <button class="btn-skip" onclick="skipTutorial()">Pular</button>
                <button class="btn-next" onclick="nextSlide()">Pr√≥ximo</button>
            </div>
        </div>
    </div>

<script src="js/conquistas-utils.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
      const token = sessionStorage.getItem("token");
      if (!token) return;
      
      // Carrega avatar (primeiro do sessionStorage, depois do backend)
      const menuAvatar = document.getElementById("menuAvatar");
      let savedAvatar = sessionStorage.getItem("alunoAvatar");
      
      if (savedAvatar && menuAvatar) {
          menuAvatar.src = savedAvatar;
      } else if (menuAvatar) {
          // Se n√£o tiver no sessionStorage, busca do backend
          try {
              const avatarResponse = await fetch("http://localhost:8000/api/avatar/show", {
                  headers: { 
                      "Authorization": `Bearer ${token}`,
                      "Accept": "application/json",
                  },
              });
              if (avatarResponse.ok) {
                  const avatarData = await avatarResponse.json();
                  if (avatarData.avatar_url) {
                      menuAvatar.src = avatarData.avatar_url;
                      sessionStorage.setItem("alunoAvatar", avatarData.avatar_url);
                  }
              }
          } catch (error) {
              console.warn("Erro ao carregar avatar:", error);
          }
      }

      // ‚úÖ Busca dados do aluno sempre no primeiro carregamento da p√°gina
      try {
          const res = await fetch(`${API_URL}/api/alunos/me`, {
              headers: { "Authorization": `Bearer ${token}` }
          });

          if (!res.ok) throw new Error("Falha ao buscar aluno");

          const aluno = await res.json();
          
          console.log("Aluno carregado:", aluno);
          console.log("Primeiro login?", aluno.primeiro_login);

          // ‚úÖ Salva o nome do aluno na session (em todos os logins)
          sessionStorage.setItem("alunoNome", aluno.name);
          
          // Define o nome do usu√°rio no elemento, se existir
          const nomeUsuarioEl = document.getElementById("nome-usuario");
          if (nomeUsuarioEl) {
              nomeUsuarioEl.textContent = aluno.name;
          }

          // ================================
          // SISTEMA DE TUTORIAL DE BOAS-VINDAS
          // ================================
          const tutorialSlides = [
              {
                  icon: 'Imagens/Logo sem Fundo.png',
                  title: 'Bem-vindo(a) ao BrainForms!',
                  text: `Ol√°, <span style="font-weight:bold; color: #650591;">${aluno.name}</span>! Estamos muito felizes em ter voc√™ aqui. Prepare-se para explorar o mundo da Matem√°tica e F√≠sica de forma divertida e interativa!`
              },
              {
                  icon: 'Imagens/matCalc.png',
                  title: 'F√≥rmulas Interativas',
                  text: 'Explore diversas f√≥rmulas de Matem√°tica e F√≠sica! Calcule equa√ß√µes, geometria, convers√µes de temperatura e muito mais. Cada c√°lculo conta para suas conquistas!'
              },
              {
                  icon: 'Imagens/quest.png',
                  title: 'Question√°rios',
                  text: 'Teste seus conhecimentos com question√°rios de Matem√°tica e F√≠sica! Resolva exerc√≠cios pr√°ticos, aprenda com feedback imediato e acompanhe seu progresso.'
              },
              {
                  icon: 'Imagens/Tquizz2.png',
                  title: 'Time Quizz',
                  text: 'Desafie-se contra o tempo! Responda quest√µes rapidamente e teste sua agilidade mental. Quanto mais r√°pido, melhor sua pontua√ß√£o!'
              },
              {
                  icon: 'Imagens/conquistasTitulo.png',
                  title: 'Conquistas',
                  text: 'Complete desafios e desbloqueie conquistas incr√≠veis! Cada a√ß√£o no BrainForms pode render uma nova conquista. Colete todas elas!'
              },
              {
                  icon: 'Imagens/perfilDefault.png',
                  title: 'Seu Perfil',
                  text: 'Personalize seu perfil com avatares √∫nicos! Escolha entre v√°rios avatares ou fa√ßa upload da sua pr√≥pria foto. Mostre sua personalidade!'
              }
          ];

          let currentSlide = 0;

          function renderSlide(index) {
              const slide = tutorialSlides[index];
              const content = document.getElementById('tutorial-content');
              
              content.innerHTML = `
                  <img src="${slide.icon}" alt="${slide.title}">
                  <h1>${slide.title}</h1>
                  <h3>${slide.text}</h3>
              `;

              // Atualizar dots de progresso
              const dotsContainer = document.getElementById('progress-dots');
              dotsContainer.innerHTML = tutorialSlides.map((_, i) => 
                  `<div class="progress-dot ${i === index ? 'active' : ''}"></div>`
              ).join('');

              // Atualizar texto do bot√£o
              const nextBtn = document.querySelector('.btn-next');
              if (nextBtn) {
                  nextBtn.textContent = index === tutorialSlides.length - 1 ? 'Come√ßar' : 'Pr√≥ximo';
              }
          }

          window.nextSlide = () => {
              if (currentSlide < tutorialSlides.length - 1) {
                  currentSlide++;
                  renderSlide(currentSlide);
              } else {
                  finishTutorial();
              }
          };

          window.skipTutorial = () => {
              finishTutorial();
          };

          async function finishTutorial() {
              console.log("üé¨ Finalizando tutorial...");
              document.getElementById("start-overlay").style.display = "none";

              try {
                  console.log("üì° Marcando boas-vindas no backend...");
                  const response = await fetch(`${API_URL}/api/alunos/${aluno.id}/marcar-boas-vindas`, {
                      method: "POST",
                      headers: {
                          "Authorization": `Bearer ${token}`,
                          "Content-Type": "application/json"
                      }
                  });
                  console.log("‚úÖ Boas-vindas marcadas com sucesso:", await response.json());
              } catch (err) {
                  console.error("‚ùå Erro ao marcar boas-vindas:", err);
              }

              // Marcar que o aluno j√° viu o tutorial
              sessionStorage.setItem("alunoCarregado", "true");

              // Mostrar conquistas automaticamente
              try {
                  console.log("üèÜ Carregando conquistas...");
                  const conquistas = await window.carregarConquistasAPI?.();
                  console.log("üìã Conquistas carregadas:", conquistas);
                  
                  if (conquistas?.length) {
                      console.log("üéâ Mostrando conquistas ao usu√°rio...");
                      window.mostrarNovasConquistasLocal?.(conquistas, true);
                  } else {
                      console.log("‚ÑπÔ∏è Nenhuma conquista para mostrar");
                  }
              } catch (err) {
                  console.error("‚ùå Erro ao carregar conquistas:", err);
              }
          }

          // FUN√á√ÉO GLOBAL DE IN√çCIO (mantida para compatibilidade)
          window.startGame = finishTutorial;

          // ====================================================
          // VERIFICAR E MOSTRAR TUTORIAL SE FOR PRIMEIRO LOGIN
          // ====================================================
          if (aluno.primeiro_login) {
              console.log("üéì √â o primeiro login! Mostrando tutorial...");
              
              const overlayEl = document.getElementById("start-overlay");
              if (!overlayEl) {
                  console.error("‚ùå Elemento start-overlay n√£o encontrado!");
                  return;
              }
              
              overlayEl.style.display = "flex";
              console.log("‚úÖ Overlay exibido");
              
              // Renderizar primeiro slide
              renderSlide(0);
              console.log("‚úÖ Primeiro slide renderizado");
          } else {
              console.log("‚úÖ N√£o √© primeiro login. Tutorial j√° foi visto.");
              // Marca que o aluno foi carregado nesta sess√£o
              sessionStorage.setItem("alunoCarregado", "true");
          }

      } catch (err) {
          console.error("Erro ao carregar aluno:", err);
      }
  });

  // ================================
  // Fun√ß√£o para trocar avatar
  // ================================
  function trocarAvatar(src) {
      document.getElementById('mainAvatar').src = src;
      try {
          sessionStorage.setItem('alunoAvatar', src);
      } catch (e) {
          console.warn('N√£o foi poss√≠vel salvar o avatar na sessionStorage:', e);
      }
  }

  // Upload de imagem personalizada
  document.getElementById("uploadInput").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
              const dataUrl = e.target.result;
              document.getElementById("mainAvatar").src = dataUrl;
              try {
                  sessionStorage.setItem('alunoAvatar', dataUrl);
              } catch (err) {
                  console.warn('N√£o foi poss√≠vel salvar avatar na sessionStorage:', err);
              }
          }
          reader.readAsDataURL(file);
      }
  });
</script>



</body>
</html>
